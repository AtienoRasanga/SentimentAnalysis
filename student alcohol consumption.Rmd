---
title: "Alcoholism"
author: "Fiona"
date: "23 September 2017"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
datamat <- read.csv("C:/Users/Fiona/Documents/Kaggle Datasets/Student Alcohol/student-mat.csv", header = TRUE)

datapor <- read.csv("C:/Users/Fiona/Documents/Kaggle Datasets/Student Alcohol/student-por.csv", header = TRUE)

```

#Merge the two datasets

```{r}

data=merge(datamat,datapor,by=c("school","sex","age","address","famsize","Pstatus","Medu","Fedu","Mjob","Fjob","reason","nursery","internet"))

```

#Determine if there is incomplete data

```{r}
sum(!complete.cases(data))

```

#Exploratory Data Analysis 
```{r}
#install.packages("ggplot2")
#library(ggplot2)

```

#Install packages for categorical variable data exploration 

```{r}
#install.packages("vcd")
#library(vcd)
```

```{r}
#install.packages("vegan")
#library(vegan)
```
#Univariate EDA
```{r}
#Mean Age of Students

mean(data$age)

#

```

#Distribution of students in schools
```{r}

ggplot(mapping=aes(data$school), data)+geom_bar()
```
#Performance of in each of the schools

```{r}
 ggplot(aes(data$school,data$G3.x), data=data)+geom_boxplot()

```

#Conduct linear regression using the predictor variables. 

```{r}
predictors.x <- c(colnames(data[,1:30]))

lm_model <- lm(scoremean.x ~ data$school+data$sex+data$age+data$address+data$famsize+data$Pstatus+data$Medu+data$Fedu+data$Mjob+data$Fjob+data$reason+data$nursery+data$internet+data$guardian.x+data$traveltime.x+data$studytime.x+data$failures.x+data$schoolsup.x+data$famsup.x+data$paid.x+data$activities.x+data$higher.x+data$romantic.x+data$famrel.x+data$freetime.x+data$goout.x+data$Dalc.x+data$Walc.x+data$health.x+data$absences.x, data = data)

summary(lm_model)


```


#Use Forward Selection, Backward elimination, Stepwise regression to create a model of predictors

```{r}
#Forward Selection -  Use step () function

lm_null <- lm(scoremean.x ~ 1, data = data)

summary(lm_null)
```


#Use regsubsets() from the leap library()

```{r}
install.packages("leaps")
library(leaps)
```

```{r}
#Forward Selection - Model starts with null and builds according to the varible that reduces the least square

lmmodel_forward <- /step(lm_null, scope = list(lower=lm_null, upper=lm_model), direction = "forward")
```

According to Forward Selection, the best model combines the following variables 

scoremean.x ~ data$failures.x + data$Mjob + data$sex + data$goout.x + 
    data$schoolsup.x + data$higher.x + data$health.x + data$age + 
    data$studytime.x + data$famsup.x + data$Fedu + data$famsize + 
    data$romantic.x

```{r}
#Backward Selection

lmmodel_backward <- step(lm_model, data, direction = "backward")

```

According to the backward elimination the predictor variables should be the following 

scoremean.x ~ data$sex + data$age + data$famsize + data$Medu + 
    data$Mjob + data$Fjob + data$internet + data$traveltime.x + 
    data$studytime.x + data$failures.x + data$schoolsup.x + data$famsup.x + 
    data$higher.x + data$romantic.x + data$freetime.x + data$goout.x + 
    data$health.x

```{r}
#install.packages("MASS")
#library(MASS)
```


```{r}
#Using stepwise regression method

lmmodel_step <- stepAIC(lm_model, data, direction = "both")


```

```{r}
#Comparing the different Models

anova(lmmodel_backward,lmmodel_forward)
```

```{r}
lmmodel_step$anova


```

According to multiple linear regression, alcohol consumption has no bearing on the average student mark for Mathematics. 